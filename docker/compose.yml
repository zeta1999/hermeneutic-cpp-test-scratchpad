services:
  cex-notbinance:
    build:
      context: ..
      dockerfile: docker/Dockerfile.cex
    image: hermeneutic/cex:notbinance
    command: ["notbinance", "/app/data/notbinance.ndjson", "9001", "notbinance-token", "150"]
  cex-notcoinbase:
    build:
      context: ..
      dockerfile: docker/Dockerfile.cex
    image: hermeneutic/cex:notcoinbase
    command: ["notcoinbase", "/app/data/notcoinbase.ndjson", "9002", "notcoinbase-token", "200"]
  cex-notkraken:
    build:
      context: ..
      dockerfile: docker/Dockerfile.cex
    image: hermeneutic/cex:notkraken
    command: ["notkraken", "/app/data/notkraken.ndjson", "9003", "notkraken-token", "220"]
  aggregator:
    build:
      context: ..
      dockerfile: docker/Dockerfile.aggregator
    image: hermeneutic/aggregator
    depends_on:
      - cex-notbinance
      - cex-notcoinbase
      - cex-notkraken
    environment:
      HERMENEUTIC_WAIT_FOR_FEEDS: ${HERMENEUTIC_WAIT_FOR_FEEDS:-1}
    ports:
      - "50051:50051"
  bbo:
    build:
      context: ..
      dockerfile: docker/Dockerfile.bbo
    image: hermeneutic/bbo
    depends_on:
      - aggregator
    volumes:
      - ../output/bbo:/app
    command: ["aggregator:50051", "agg-docker-token", "BTCUSDT", "/app/bbo_quotes.csv"]
  volume_bands:
    build:
      context: ..
      dockerfile: docker/Dockerfile.volume
    image: hermeneutic/volume
    depends_on:
      - aggregator
    volumes:
      - ../output/volume_bands:/app
    command: ["aggregator:50051", "agg-docker-token", "BTCUSDT", "/app/volume_bands.csv"]
  price_bands:
    build:
      context: ..
      dockerfile: docker/Dockerfile.price
    image: hermeneutic/price
    depends_on:
      - aggregator
    volumes:
      - ../output/price_bands:/app
    command: ["aggregator:50051", "agg-docker-token", "BTCUSDT", "/app/price_bands.csv"]
